{"pageProps":{"note":{"id":"fb3cv62eok3am0c3pgwwtfp","title":"WebRTC signalling","desc":"","updated":1703591324237,"created":1703589664596,"custom":{},"fname":"programming.side projects.flavor flash journal.firebase.WebRTC signalling","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"4472e15d2416cbe6dfd70374d24f6651","links":[],"anchors":{"如何用firebase-collection建立一個signalling-server":{"type":"header","text":"如何用Firebase Collection建立一個signalling server?","value":"如何用firebase-collection建立一個signalling-server","line":8,"column":0,"depth":2},"建立一個直播間":{"type":"header","text":"建立一個直播間","value":"建立一個直播間","line":10,"column":0,"depth":3},"加入一個直播間":{"type":"header","text":"加入一個直播間","value":"加入一個直播間","line":26,"column":0,"depth":3},"collect-ice-candidates":{"type":"header","text":"Collect ICE candidates","value":"collect-ice-candidates","line":41,"column":0,"depth":3}},"children":[],"parent":"gl20na8txb9ctwgns65tbeb","data":{}},"body":"<h1 id=\"webrtc-signalling\">WebRTC signalling<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#webrtc-signalling\"></a></h1>\n<h2 id=\"如何用firebase-collection建立一個signalling-server\">如何用Firebase Collection建立一個signalling server?<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#如何用firebase-collection建立一個signalling-server\"></a></h2>\n<h3 id=\"建立一個直播間\">建立一個直播間<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#建立一個直播間\"></a></h3>\n<ol>\n<li>\n<p>建立一個Stream Collection，紀錄存在的直播間</p>\n</li>\n<li>\n<p>當使用者按下直播時，我們會透過<code>WebRTCClient</code>的<code>peerConnection</code>產生一個<code>RTCSessionDescription</code>(後續簡稱<code>sdp</code>，代表發起直播者提供的<code>offer</code>)，他產生的<code>sdp</code>我們會將它設為local description。接下來，我們會在Stream Collection建立一個新Document，並將這個<code>sdp</code>的資訊存在這個Document中，並給一個<code>offer</code>的key。</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\">\n<span class=\"token literal-property property\">offer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> offer<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">sdp</span><span class=\"token operator\">:</span> offer<span class=\"token punctuation\">.</span><span class=\"token property-access\">sdp</span>\n<span class=\"token punctuation\">}</span>\n\n</code></pre>\n</li>\n<li>\n<p>我們開始監聽這個直播間是否有人進入，如果有的話，將這個進來的人的<code>sdp</code>設為發起直播者的remote description</p>\n</li>\n</ol>\n<h3 id=\"加入一個直播間\">加入一個直播間<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#加入一個直播間\"></a></h3>\n<ol>\n<li>\n<p>使用者選擇一個想看的直播間，並按下加入，我們會將使用者的remote description設定成開啟直播者的<code>sdp</code>，並請<code>WebRTCClient</code>的<code>peerConnection</code>產生一個<code>answer</code>的<code>sdp</code>，並將其設為local description。</p>\n</li>\n<li>\n<p>將產生的answer <code>sdp</code>寫入該直播間的document field</p>\n<pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token literal-property property\">answer</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token literal-property property\">type</span><span class=\"token operator\">:</span> answer<span class=\"token punctuation\">.</span><span class=\"token property-access\">type</span><span class=\"token punctuation\">,</span>\n  <span class=\"token literal-property property\">sdp</span><span class=\"token operator\">:</span> answer<span class=\"token punctuation\">.</span><span class=\"token property-access\">sdp</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>\n</li>\n<li>\n<p>這時候開啟直播的人就會監聽到stream doc的變動，並將加入者的<code>sdp</code>設為其remote description，並完成了發起直播與加入直播之間的<code>sdp</code>交換</p>\n</li>\n</ol>\n<h3 id=\"collect-ice-candidates\">Collect ICE candidates<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#collect-ice-candidates\"></a></h3>","noteIndex":{"id":"root","title":"root","desc":"","updated":1605266684036,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"b49e7e13a0c91addc8ab9ef97080cf1e","links":[],"anchors":{},"children":["p1jj2aztluo4pb12qn8gunp","avquk6puzxi790rxzodnfmh","rn0e0y5coqo8iyqfxd7ocsk","c1bs7wsjfbhb0zipaywqv1"],"parent":null,"data":{},"body":"\nThis is the root for your Dendron vault.\n\nIf you decide to publish your entire vault, it will be your landing page. You are free to customize any part of this page except the frontmatter at the top, between the `---`.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://qazwsx521943.github.io","assetsPrefix":"/programming_notes","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}