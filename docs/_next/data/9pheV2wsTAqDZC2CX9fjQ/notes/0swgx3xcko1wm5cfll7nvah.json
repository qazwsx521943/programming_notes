{"pageProps":{"note":{"id":"0swgx3xcko1wm5cfll7nvah","title":"Actors","desc":"","updated":1704559306033,"created":1704531174758,"custom":{},"fname":"programming.language.swift.concurrency.actors","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"d98185c24bc244a1c0e0d8958bf4b49d","links":[],"anchors":{"what-did-actor-solved":{"type":"header","text":"What did Actor solved?","value":"what-did-actor-solved","line":8,"column":0,"depth":2},"how-did-it-solved":{"type":"header","text":"How did it solved?","value":"how-did-it-solved","line":12,"column":0,"depth":2},"actor-isolation":{"type":"header","text":"Actor isolation","value":"actor-isolation","line":16,"column":0,"depth":2},"nonisolated":{"type":"header","text":"nonisolated","value":"nonisolated","line":29,"column":0,"depth":2}},"children":[],"parent":"2ho1m3s6l88vvkis0fk0zwq","data":{}},"body":"<h1 id=\"actors\">Actors<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#actors\"></a></h1>\n<h2 id=\"what-did-actor-solved\">What did <strong>Actor</strong> solved?<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#what-did-actor-solved\"></a></h2>\n<p>高併發所產生的data race問題。</p>\n<h2 id=\"how-did-it-solved\">How did it solved?<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#how-did-it-solved\"></a></h2>\n<p>透過Actor宣告的類別，instance會有一個數據隔離的特性，所有想要存取到該instance的外部資源都需要排入一個serial queue，以這個方式確保不會有同時修改到instance資源的問題。</p>\n<h2 id=\"actor-isolation\">Actor isolation<a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#actor-isolation\"></a></h2>\n<p>以實例為單位，將內部資源與外部資源隔離。</p>\n<ul>\n<li>\n<p>需要隔離(會動到<code>mutable</code>屬性)：</p>\n<ul>\n<li><code>var</code>宣告的stored property、computed property</li>\n<li>methods</li>\n</ul>\n</li>\n<li>\n<p>不需隔離(<code>immutable</code>屬性無法被更改)：</p>\n<ul>\n<li>以<code>let</code>宣告的stored property</li>\n</ul>\n</li>\n</ul>\n<p>只有潛在可能更改到內部資源的訪問會需要隔離。</p>\n<h2 id=\"nonisolated\"><code>nonisolated</code><a aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#nonisolated\"></a></h2>\n<p>有的時候，我們很確定某些computed property、function並不會引起data race，這時候我們就可以透過<code>nonisolated</code>在屬性前面做標記，減少性能損耗。</p>\n<p>當然，標記<code>nonisolated</code>的computed property跟function在內部都不能存取到actor實體的<code>mutable</code>屬性。</p>\n<pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">actor</span> <span class=\"token class-name\">Profile</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> birthDay<span class=\"token punctuation\">:</span> <span class=\"token class-name\">String</span>\n\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token keyword\">extension</span> <span class=\"token class-name\">Profile</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">nonisolated</span> <span class=\"token keyword\">func</span> <span class=\"token function-definition function\">familyNameLength</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span>  <span class=\"token punctuation\">{</span>\n\n        <span class=\"token keyword\">let</span> dateFormatter <span class=\"token operator\">=</span> <span class=\"token class-name\">DateFormatter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        dateFormatter<span class=\"token punctuation\">.</span>dateFormat <span class=\"token operator\">=</span> <span class=\"token string-literal\"><span class=\"token string\">\"yyyy-MM-dd\"</span></span>\n        <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> startDate <span class=\"token operator\">=</span> dateFormatter<span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span> birthDay<span class=\"token punctuation\">)</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"Failed to convert start date string to date.\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n\n        <span class=\"token keyword\">let</span> endDate <span class=\"token operator\">=</span> <span class=\"token class-name\">Date</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">let</span> calendar <span class=\"token operator\">=</span> <span class=\"token class-name\">Calendar</span><span class=\"token punctuation\">.</span>current\n        <span class=\"token keyword\">let</span> components <span class=\"token operator\">=</span> calendar<span class=\"token punctuation\">.</span><span class=\"token function\">dateComponents</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">.</span>day<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">:</span> startDate<span class=\"token punctuation\">,</span> to<span class=\"token punctuation\">:</span> endDate<span class=\"token punctuation\">)</span>\n\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> daysDifference <span class=\"token operator\">=</span> components<span class=\"token punctuation\">.</span>day <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"1998/06/30 到今天相隔 </span><span class=\"token interpolation-punctuation punctuation\">\\(</span><span class=\"token interpolation\">daysDifference</span><span class=\"token interpolation-punctuation punctuation\">)</span><span class=\"token string\"> 天。\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-literal\"><span class=\"token string\">\"無法計算日期差距。\"</span></span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n</code></pre>","noteIndex":{"id":"root","title":"My Second Brain","desc":"","updated":1703774418339,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"ce2f2d82cf7fe71b3a5900a8f91fd111","links":[],"anchors":{"welcome-to-my-learning-repository-":{"type":"header","text":"Welcome to my learning repository! 📚","value":"welcome-to-my-learning-repository-","line":8,"column":0,"depth":2}},"children":["j416lb0sk2vag9yvgr9bxzb","ski4xep9sjz6v7rxjf1fln1","avquk6puzxi790rxzodnfmh","rn0e0y5coqo8iyqfxd7ocsk"],"parent":null,"data":{},"body":"\n## Welcome to my learning repository! 📚\n\n**Disclaimer:**\n\nThe content in this repository is a work in progress and should not be considered an authoritative source of information. These notes are currently being compiled during my learning journey at AppWorks School. They are subject to change, and there may be gaps in organization and accuracy.\n\n**Note Status:**\n\nI am actively working on organizing and rectifying any inaccuracies. Expect a more comprehensive set of notes by 2024/01/19.\n\n**Reading guide:**\n\n> Block quotes like this generally means this paragraph is quoted by official documentation.\n\n```swift\n// Example code is typically simplified and may not be practical in real-world scenarios.\n// It is created solely to aid my understanding of the underlying concepts related to a specific topic.\n```\n\nFeel free to connect with me and share your thoughts or suggestions regarding my note-taking process. I appreciate any feedback and collaboration to enhance the quality of these notes.\n\nHappy learning! 🚀"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://qazwsx521943.github.io","assetsPrefix":"/programming_notes","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}