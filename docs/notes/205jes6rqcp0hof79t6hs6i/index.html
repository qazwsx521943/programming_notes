<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/programming_notes/favicon.ico"/><title>Concurrency</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="Concurrency"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://qazwsx521943.github.io/programming_notes/notes/205jes6rqcp0hof79t6hs6i/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023/10/28"/><meta property="article:modified_time" content="2023/10/30"/><link rel="canonical" href="https://qazwsx521943.github.io/programming_notes/notes/205jes6rqcp0hof79t6hs6i/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/programming_notes/_next/static/css/b0cd2e9ac14c3b4a.css" as="style"/><link rel="stylesheet" href="/programming_notes/_next/static/css/b0cd2e9ac14c3b4a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/programming_notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/programming_notes/_next/static/chunks/webpack-228838cbd1a05a99.js" defer=""></script><script src="/programming_notes/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/programming_notes/_next/static/chunks/main-ae055e704e2f54e8.js" defer=""></script><script src="/programming_notes/_next/static/chunks/pages/_app-c5ac04a5d7ae899a.js" defer=""></script><script src="/programming_notes/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/programming_notes/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/programming_notes/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/programming_notes/_next/static/nSFlPafzYJhNeKeOHrNay/_buildManifest.js" defer=""></script><script src="/programming_notes/_next/static/nSFlPafzYJhNeKeOHrNay/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="concurrency">Concurrency<a aria-hidden="true" class="anchor-heading icon-link" href="#concurrency"></a></h1>
<h2 id="為什麼我們要好好的處理concurrency">為什麼我們要好好的處理concurrency?<a aria-hidden="true" class="anchor-heading icon-link" href="#為什麼我們要好好的處理concurrency"></a></h2>
<p>設計良好的concurrency code可以讓我們充分使用到CPU的資源</p>
<h2 id="如何使用dispatchqueue">如何使用DispatchQueue?<a aria-hidden="true" class="anchor-heading icon-link" href="#如何使用dispatchqueue"></a></h2>
<p><strong>DispatchQueue</strong>就是幫我們管理Tasks的一個物件。</p>
<h3 id="step-1-取得或建立一個dispatchqueue">Step 1: 取得或建立一個DispatchQueue<a aria-hidden="true" class="anchor-heading icon-link" href="#step-1-取得或建立一個dispatchqueue"></a></h3>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> mainQueue <span class="token operator">=</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span>main  <span class="token comment">// Serial</span>

<span class="token keyword">let</span> globalQueue <span class="token operator">=</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// Concurrent</span>

<span class="token keyword">let</span> customQueue <span class="token operator">=</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">(</span>label<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"example.com.domain"</span></span><span class="token punctuation">)</span> <span class="token comment">// default Serial</span>
</code></pre>
<h3 id="step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task">Step 2: 我們可以透過以下方式提交Task到一個DispatchQueue物件上，並指定DispatchQueue要如何執行這個Task<a aria-hidden="true" class="anchor-heading icon-link" href="#step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task"></a></h3>
<pre class="language-swift"><code class="language-swift">globalQueue<span class="token punctuation">.</span>sync <span class="token punctuation">{</span>
  <span class="token comment">// Task1...</span>
<span class="token punctuation">}</span>

globatQueue<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
  <span class="token comment">// Task2...</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="什麼是dispatchitem為何要使用他">什麼是DispatchItem？為何要使用他？<a aria-hidden="true" class="anchor-heading icon-link" href="#什麼是dispatchitem為何要使用他"></a></h2>
<p>如果我們想要控制我們的Task狀態呢？ ex: 在三秒內沒有回傳結果時我想要取消這個Task</p>
<ol>
<li>
<p>情境1:  使用者輸入UISearchBar時，不希望每次text change都打一次API，造成後端的負擔。</p>
<p>我們可以將Task透過DispatchItem封裝，再透過DispatchQueue設定asyncAfter延後執行這個DispatchItem，我們就可以達到延遲fetch資料，減少對後端的負載</p>
</li>
</ol>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> workItem <span class="token operator">=</span> <span class="token class-name">DispatchWorkItem</span> <span class="token punctuation">{</span>
  <span class="token comment">// Task1...</span>
<span class="token punctuation">}</span>

globalQueue<span class="token punctuation">.</span><span class="token keyword">async</span><span class="token punctuation">(</span>execute<span class="token punctuation">:</span> workItem<span class="token punctuation">)</span>
</code></pre>
<h2 id="什麼是dispatchgroup-為何要使用他">什麼是DispatchGroup? 為何要使用他？<a aria-hidden="true" class="anchor-heading icon-link" href="#什麼是dispatchgroup-為何要使用他"></a></h2>
<ol>
<li>情境1: 我們有一個陣列的api要打，我們希望他可以全部加載完再一次更新到畫面上</li>
</ol>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> globalQueue <span class="token operator">=</span> <span class="token class-name">DispatchQueue</span><span class="token punctuation">.</span><span class="token function">global</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> loadImageGroup <span class="token operator">=</span> <span class="token class-name">DispatchGroup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

loadImageGroup<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
globalQueue<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">task1</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> response <span class="token keyword">in</span>
        <span class="token operator">...</span>
        loadImageGroup<span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

loadImageGroup<span class="token punctuation">.</span><span class="token function">enter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
globalQueue<span class="token punctuation">.</span><span class="token keyword">async</span> <span class="token punctuation">{</span>
    <span class="token function">task2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> response <span class="token keyword">in</span>
        <span class="token operator">...</span>
        loadImageGroup<span class="token punctuation">.</span><span class="token function">leave</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 1. wait synchronously for all tasks to finish</span>
loadImageGroup<span class="token punctuation">.</span><span class="token function">wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// ↓ Tasks that need to be done after loadImageGroup's task are all done</span>
<span class="token function">print</span><span class="token punctuation">(</span><span class="token string-literal"><span class="token string">"all done"</span></span><span class="token punctuation">)</span>


<span class="token comment">// 2. adding a completion handler for loadImageGroup</span>
loadImageGroup<span class="token punctuation">.</span><span class="token function">notify</span><span class="token punctuation">(</span>queue<span class="token punctuation">:</span> <span class="token punctuation">.</span>main<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ui update code</span>
<span class="token punctuation">}</span>

</code></pre>
<h2 id="什麼是dispatchsemaphore為何要使用他">什麼是DispatchSemaphore？為何要使用他？<a aria-hidden="true" class="anchor-heading icon-link" href="#什麼是dispatchsemaphore為何要使用他"></a></h2>
<h2 id="什麼是barrier為何要使用他">什麼是Barrier？為何要使用他？<a aria-hidden="true" class="anchor-heading icon-link" href="#什麼是barrier為何要使用他"></a></h2>
<p>當把Task加到Concurrent Queue中，有時候不同Thread的Task會需要共同存取+修改到某個Value，造成一些Bug。</p>
<p>透過在submit一個task時設定這個Task被執行時不能有其他task存取到同一個共同資源，可以確保這個task執行時不會有其他存取到共同資源的Task在其他Thread中存取。</p>
<p><img src="/programming_notes/assets/images/language.swift.grand-central-dispatch.concurrency_barrierConcept.png"></p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#為什麼我們要好好的處理concurrency" title="為什麼我們要好好的處理concurrency?">為什麼我們要好好的處理concurrency?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#如何使用dispatchqueue" title="如何使用DispatchQueue?">如何使用DispatchQueue?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#step-1-取得或建立一個dispatchqueue" title="Step 1: 取得或建立一個DispatchQueue">Step 1: 取得或建立一個DispatchQueue</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task" title="Step 2: 我們可以透過以下方式提交Task到一個DispatchQueue物件上，並指定DispatchQueue要如何執行這個Task">Step 2: 我們可以透過以下方式提交Task到一個DispatchQueue物件上，並指定DispatchQueue要如何執行這個Task</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#什麼是dispatchitem為何要使用他" title="什麼是DispatchItem？為何要使用他？">什麼是DispatchItem？為何要使用他？</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#什麼是dispatchgroup-為何要使用他" title="什麼是DispatchGroup? 為何要使用他？">什麼是DispatchGroup? 為何要使用他？</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#什麼是dispatchsemaphore為何要使用他" title="什麼是DispatchSemaphore？為何要使用他？">什麼是DispatchSemaphore？為何要使用他？</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#什麼是barrier為何要使用他" title="什麼是Barrier？為何要使用他？">什麼是Barrier？為何要使用他？</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"205jes6rqcp0hof79t6hs6i","title":"Concurrency","desc":"","updated":1698670697373,"created":1698463425918,"custom":{},"fname":"programming.language.swift.grand-central-dispatch.concurrency","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"83746cf15bda54403acd9ed4cf2ec08a","links":[],"anchors":{"為什麼我們要好好的處理concurrency":{"type":"header","text":"為什麼我們要好好的處理concurrency?","value":"為什麼我們要好好的處理concurrency","line":8,"column":0,"depth":2},"如何使用dispatchqueue":{"type":"header","text":"如何使用DispatchQueue?","value":"如何使用dispatchqueue","line":12,"column":0,"depth":2},"step-1-取得或建立一個dispatchqueue":{"type":"header","text":"Step 1: 取得或建立一個DispatchQueue","value":"step-1-取得或建立一個dispatchqueue","line":16,"column":0,"depth":3},"step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task":{"type":"header","text":"Step 2: 我們可以透過以下方式提交Task到一個DispatchQueue物件上，並指定DispatchQueue要如何執行這個Task","value":"step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task","line":26,"column":0,"depth":3},"什麼是dispatchitem為何要使用他":{"type":"header","text":"什麼是DispatchItem？為何要使用他？","value":"什麼是dispatchitem為何要使用他","line":38,"column":0,"depth":2},"什麼是dispatchgroup-為何要使用他":{"type":"header","text":"什麼是DispatchGroup? 為何要使用他？","value":"什麼是dispatchgroup-為何要使用他","line":55,"column":0,"depth":2},"什麼是dispatchsemaphore為何要使用他":{"type":"header","text":"什麼是DispatchSemaphore？為何要使用他？","value":"什麼是dispatchsemaphore為何要使用他","line":92,"column":0,"depth":2},"什麼是barrier為何要使用他":{"type":"header","text":"什麼是Barrier？為何要使用他？","value":"什麼是barrier為何要使用他","line":94,"column":0,"depth":2}},"children":[],"parent":"m2klofp5yj7niqiawmu25a0","data":{}},"body":"\u003ch1 id=\"concurrency\"\u003eConcurrency\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#concurrency\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"為什麼我們要好好的處理concurrency\"\u003e為什麼我們要好好的處理concurrency?\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#為什麼我們要好好的處理concurrency\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e設計良好的concurrency code可以讓我們充分使用到CPU的資源\u003c/p\u003e\n\u003ch2 id=\"如何使用dispatchqueue\"\u003e如何使用DispatchQueue?\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#如何使用dispatchqueue\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cstrong\u003eDispatchQueue\u003c/strong\u003e就是幫我們管理Tasks的一個物件。\u003c/p\u003e\n\u003ch3 id=\"step-1-取得或建立一個dispatchqueue\"\u003eStep 1: 取得或建立一個DispatchQueue\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#step-1-取得或建立一個dispatchqueue\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e mainQueue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain  \u003cspan class=\"token comment\"\u003e// Serial\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e globalQueue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eglobal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// Concurrent\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e customQueue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003elabel\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"example.com.domain\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token comment\"\u003e// default Serial\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task\"\u003eStep 2: 我們可以透過以下方式提交Task到一個DispatchQueue物件上，並指定DispatchQueue要如何執行這個Task\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#step-2-我們可以透過以下方式提交task到一個dispatchqueue物件上並指定dispatchqueue要如何執行這個task\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003eglobalQueue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003esync \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Task1...\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\nglobatQueue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Task2...\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"什麼是dispatchitem為何要使用他\"\u003e什麼是DispatchItem？為何要使用他？\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#什麼是dispatchitem為何要使用他\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e如果我們想要控制我們的Task狀態呢？ ex: 在三秒內沒有回傳結果時我想要取消這個Task\u003c/p\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e情境1:  使用者輸入UISearchBar時，不希望每次text change都打一次API，造成後端的負擔。\u003c/p\u003e\n\u003cp\u003e我們可以將Task透過DispatchItem封裝，再透過DispatchQueue設定asyncAfter延後執行這個DispatchItem，我們就可以達到延遲fetch資料，減少對後端的負載\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e workItem \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatchWorkItem\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// Task1...\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\nglobalQueue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eexecute\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e workItem\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"什麼是dispatchgroup-為何要使用他\"\u003e什麼是DispatchGroup? 為何要使用他？\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#什麼是dispatchgroup-為何要使用他\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003e情境1: 我們有一個陣列的api要打，我們希望他可以全部加載完再一次更新到畫面上\u003c/li\u003e\n\u003c/ol\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e globalQueue \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatchQueue\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eglobal\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e loadImageGroup \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eDispatchGroup\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\nloadImageGroup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eenter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nglobalQueue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003etask1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e response \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n        loadImageGroup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eleave\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\nloadImageGroup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eenter\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\nglobalQueue\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003easync\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token function\"\u003etask2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e response \u003cspan class=\"token keyword\"\u003ein\u003c/span\u003e\n        \u003cspan class=\"token operator\"\u003e...\u003c/span\u003e\n        loadImageGroup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eleave\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// 1. wait synchronously for all tasks to finish\u003c/span\u003e\nloadImageGroup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003ewait\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token comment\"\u003e// ↓ Tasks that need to be done after loadImageGroup's task are all done\u003c/span\u003e\n\u003cspan class=\"token function\"\u003eprint\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"all done\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n\n\u003cspan class=\"token comment\"\u003e// 2. adding a completion handler for loadImageGroup\u003c/span\u003e\nloadImageGroup\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003enotify\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003equeue\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003emain\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token comment\"\u003e// ui update code\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"什麼是dispatchsemaphore為何要使用他\"\u003e什麼是DispatchSemaphore？為何要使用他？\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#什麼是dispatchsemaphore為何要使用他\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch2 id=\"什麼是barrier為何要使用他\"\u003e什麼是Barrier？為何要使用他？\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#什麼是barrier為何要使用他\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e當把Task加到Concurrent Queue中，有時候不同Thread的Task會需要共同存取+修改到某個Value，造成一些Bug。\u003c/p\u003e\n\u003cp\u003e透過在submit一個task時設定這個Task被執行時不能有其他task存取到同一個共同資源，可以確保這個task執行時不會有其他存取到共同資源的Task在其他Thread中存取。\u003c/p\u003e\n\u003cp\u003e\u003cimg src=\"/programming_notes/assets/images/language.swift.grand-central-dispatch.concurrency_barrierConcept.png\"\u003e\u003c/p\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1605266684036,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"b49e7e13a0c91addc8ab9ef97080cf1e","links":[],"anchors":{},"children":["p1jj2aztluo4pb12qn8gunp","avquk6puzxi790rxzodnfmh","rn0e0y5coqo8iyqfxd7ocsk","c1bs7wsjfbhb0zipaywqv1"],"parent":null,"data":{},"body":"\nThis is the root for your Dendron vault.\n\nIf you decide to publish your entire vault, it will be your landing page. You are free to customize any part of this page except the frontmatter at the top, between the `---`.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://qazwsx521943.github.io","assetsPrefix":"/programming_notes","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"205jes6rqcp0hof79t6hs6i"},"buildId":"nSFlPafzYJhNeKeOHrNay","assetPrefix":"/programming_notes","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>