<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/programming_notes/favicon.ico"/><title>WebRTC signalling</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="WebRTC signalling"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://qazwsx521943.github.io/programming_notes/notes/fb3cv62eok3am0c3pgwwtfp/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023/12/26"/><meta property="article:modified_time" content="2023/12/26"/><link rel="canonical" href="https://qazwsx521943.github.io/programming_notes/notes/fb3cv62eok3am0c3pgwwtfp/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/programming_notes/_next/static/css/b0cd2e9ac14c3b4a.css" as="style"/><link rel="stylesheet" href="/programming_notes/_next/static/css/b0cd2e9ac14c3b4a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/programming_notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/programming_notes/_next/static/chunks/webpack-228838cbd1a05a99.js" defer=""></script><script src="/programming_notes/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/programming_notes/_next/static/chunks/main-ae055e704e2f54e8.js" defer=""></script><script src="/programming_notes/_next/static/chunks/pages/_app-c5ac04a5d7ae899a.js" defer=""></script><script src="/programming_notes/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/programming_notes/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/programming_notes/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/programming_notes/_next/static/nSFlPafzYJhNeKeOHrNay/_buildManifest.js" defer=""></script><script src="/programming_notes/_next/static/nSFlPafzYJhNeKeOHrNay/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="webrtc-signalling">WebRTC signalling<a aria-hidden="true" class="anchor-heading icon-link" href="#webrtc-signalling"></a></h1>
<h2 id="如何用firebase-collection建立一個signalling-server">如何用Firebase Collection建立一個signalling server?<a aria-hidden="true" class="anchor-heading icon-link" href="#如何用firebase-collection建立一個signalling-server"></a></h2>
<h3 id="建立一個直播間">建立一個直播間<a aria-hidden="true" class="anchor-heading icon-link" href="#建立一個直播間"></a></h3>
<ol>
<li>
<p>建立一個Stream Collection，紀錄存在的直播間</p>
</li>
<li>
<p>當使用者按下直播時，我們會透過<code>WebRTCClient</code>的<code>peerConnection</code>產生一個<code>RTCSessionDescription</code>(後續簡稱<code>sdp</code>，代表發起直播者提供的<code>offer</code>)，他產生的<code>sdp</code>我們會將它設為local description。接下來，我們會在Stream Collection建立一個新Document，並將這個<code>sdp</code>的資訊存在這個Document中，並給一個<code>offer</code>的key。</p>
<pre class="language-javascript"><code class="language-javascript">
<span class="token literal-property property">offer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> offer<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sdp</span><span class="token operator">:</span> offer<span class="token punctuation">.</span><span class="token property-access">sdp</span>
<span class="token punctuation">}</span>

</code></pre>
</li>
<li>
<p>我們開始監聽這個直播間是否有人進入，如果有的話，將這個進來的人的<code>sdp</code>設為發起直播者的remote description</p>
</li>
</ol>
<h3 id="加入一個直播間">加入一個直播間<a aria-hidden="true" class="anchor-heading icon-link" href="#加入一個直播間"></a></h3>
<ol>
<li>
<p>使用者選擇一個想看的直播間，並按下加入，我們會將使用者的remote description設定成開啟直播者的<code>sdp</code>，並請<code>WebRTCClient</code>的<code>peerConnection</code>產生一個<code>answer</code>的<code>sdp</code>，並將其設為local description。</p>
</li>
<li>
<p>將產生的answer <code>sdp</code>寫入該直播間的document field</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token literal-property property">answer</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">type</span><span class="token operator">:</span> answer<span class="token punctuation">.</span><span class="token property-access">type</span><span class="token punctuation">,</span>
  <span class="token literal-property property">sdp</span><span class="token operator">:</span> answer<span class="token punctuation">.</span><span class="token property-access">sdp</span>
<span class="token punctuation">}</span>
</code></pre>
</li>
<li>
<p>這時候開啟直播的人就會監聽到stream doc的變動，並將加入者的<code>sdp</code>設為其remote description，並完成了發起直播與加入直播之間的<code>sdp</code>交換</p>
</li>
</ol>
<h3 id="collect-ice-candidates">Collect ICE candidates<a aria-hidden="true" class="anchor-heading icon-link" href="#collect-ice-candidates"></a></h3></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#如何用firebase-collection建立一個signalling-server" title="如何用Firebase Collection建立一個signalling server?">如何用Firebase Collection建立一個signalling server?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#建立一個直播間" title="建立一個直播間">建立一個直播間</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#加入一個直播間" title="加入一個直播間">加入一個直播間</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#collect-ice-candidates" title="Collect ICE candidates">Collect ICE candidates</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"fb3cv62eok3am0c3pgwwtfp","title":"WebRTC signalling","desc":"","updated":1703591324237,"created":1703589664596,"custom":{},"fname":"programming.side projects.flavor flash journal.firebase.WebRTC signalling","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"4472e15d2416cbe6dfd70374d24f6651","links":[],"anchors":{"如何用firebase-collection建立一個signalling-server":{"type":"header","text":"如何用Firebase Collection建立一個signalling server?","value":"如何用firebase-collection建立一個signalling-server","line":8,"column":0,"depth":2},"建立一個直播間":{"type":"header","text":"建立一個直播間","value":"建立一個直播間","line":10,"column":0,"depth":3},"加入一個直播間":{"type":"header","text":"加入一個直播間","value":"加入一個直播間","line":26,"column":0,"depth":3},"collect-ice-candidates":{"type":"header","text":"Collect ICE candidates","value":"collect-ice-candidates","line":41,"column":0,"depth":3}},"children":[],"parent":"gl20na8txb9ctwgns65tbeb","data":{}},"body":"\u003ch1 id=\"webrtc-signalling\"\u003eWebRTC signalling\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#webrtc-signalling\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003ch2 id=\"如何用firebase-collection建立一個signalling-server\"\u003e如何用Firebase Collection建立一個signalling server?\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#如何用firebase-collection建立一個signalling-server\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003ch3 id=\"建立一個直播間\"\u003e建立一個直播間\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#建立一個直播間\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e建立一個Stream Collection，紀錄存在的直播間\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e當使用者按下直播時，我們會透過\u003ccode\u003eWebRTCClient\u003c/code\u003e的\u003ccode\u003epeerConnection\u003c/code\u003e產生一個\u003ccode\u003eRTCSessionDescription\u003c/code\u003e(後續簡稱\u003ccode\u003esdp\u003c/code\u003e，代表發起直播者提供的\u003ccode\u003eoffer\u003c/code\u003e)，他產生的\u003ccode\u003esdp\u003c/code\u003e我們會將它設為local description。接下來，我們會在Stream Collection建立一個新Document，並將這個\u003ccode\u003esdp\u003c/code\u003e的資訊存在這個Document中，並給一個\u003ccode\u003eoffer\u003c/code\u003e的key。\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\n\u003cspan class=\"token literal-property property\"\u003eoffer\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e offer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003esdp\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e offer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003esdp\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e我們開始監聽這個直播間是否有人進入，如果有的話，將這個進來的人的\u003ccode\u003esdp\u003c/code\u003e設為發起直播者的remote description\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"加入一個直播間\"\u003e加入一個直播間\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#加入一個直播間\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003col\u003e\n\u003cli\u003e\n\u003cp\u003e使用者選擇一個想看的直播間，並按下加入，我們會將使用者的remote description設定成開啟直播者的\u003ccode\u003esdp\u003c/code\u003e，並請\u003ccode\u003eWebRTCClient\u003c/code\u003e的\u003ccode\u003epeerConnection\u003c/code\u003e產生一個\u003ccode\u003eanswer\u003c/code\u003e的\u003ccode\u003esdp\u003c/code\u003e，並將其設為local description。\u003c/p\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e將產生的answer \u003ccode\u003esdp\u003c/code\u003e寫入該直播間的document field\u003c/p\u003e\n\u003cpre class=\"language-javascript\"\u003e\u003ccode class=\"language-javascript\"\u003e\u003cspan class=\"token literal-property property\"\u003eanswer\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003etype\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e answer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003etype\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\n  \u003cspan class=\"token literal-property property\"\u003esdp\u003c/span\u003e\u003cspan class=\"token operator\"\u003e:\u003c/span\u003e answer\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token property-access\"\u003esdp\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003c/li\u003e\n\u003cli\u003e\n\u003cp\u003e這時候開啟直播的人就會監聽到stream doc的變動，並將加入者的\u003ccode\u003esdp\u003c/code\u003e設為其remote description，並完成了發起直播與加入直播之間的\u003ccode\u003esdp\u003c/code\u003e交換\u003c/p\u003e\n\u003c/li\u003e\n\u003c/ol\u003e\n\u003ch3 id=\"collect-ice-candidates\"\u003eCollect ICE candidates\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#collect-ice-candidates\"\u003e\u003c/a\u003e\u003c/h3\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1605266684036,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"b49e7e13a0c91addc8ab9ef97080cf1e","links":[],"anchors":{},"children":["p1jj2aztluo4pb12qn8gunp","avquk6puzxi790rxzodnfmh","rn0e0y5coqo8iyqfxd7ocsk","c1bs7wsjfbhb0zipaywqv1"],"parent":null,"data":{},"body":"\nThis is the root for your Dendron vault.\n\nIf you decide to publish your entire vault, it will be your landing page. You are free to customize any part of this page except the frontmatter at the top, between the `---`.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://qazwsx521943.github.io","assetsPrefix":"/programming_notes","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"fb3cv62eok3am0c3pgwwtfp"},"buildId":"nSFlPafzYJhNeKeOHrNay","assetPrefix":"/programming_notes","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>