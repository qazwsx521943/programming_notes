<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><link rel="icon" href="/programming_notes/favicon.ico"/><title>Serialization</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal Knowledge Space"/><meta property="og:title" content="Serialization"/><meta property="og:description" content="Personal Knowledge Space"/><meta property="og:url" content="https://qazwsx521943.github.io/programming_notes/notes/rxplme0keulo3fon6e4gxmc/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2023/12/24"/><meta property="article:modified_time" content="2023/12/25"/><link rel="canonical" href="https://qazwsx521943.github.io/programming_notes/notes/rxplme0keulo3fon6e4gxmc/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/programming_notes/_next/static/css/b0cd2e9ac14c3b4a.css" as="style"/><link rel="stylesheet" href="/programming_notes/_next/static/css/b0cd2e9ac14c3b4a.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/programming_notes/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="/programming_notes/_next/static/chunks/webpack-228838cbd1a05a99.js" defer=""></script><script src="/programming_notes/_next/static/chunks/framework-28c999baf2863c3d.js" defer=""></script><script src="/programming_notes/_next/static/chunks/main-ae055e704e2f54e8.js" defer=""></script><script src="/programming_notes/_next/static/chunks/pages/_app-c5ac04a5d7ae899a.js" defer=""></script><script src="/programming_notes/_next/static/chunks/935-4dee79e80b8641c6.js" defer=""></script><script src="/programming_notes/_next/static/chunks/6-50972def09142ee2.js" defer=""></script><script src="/programming_notes/_next/static/chunks/pages/notes/%5Bid%5D-78d472fa3b924116.js" defer=""></script><script src="/programming_notes/_next/static/nSFlPafzYJhNeKeOHrNay/_buildManifest.js" defer=""></script><script src="/programming_notes/_next/static/nSFlPafzYJhNeKeOHrNay/_ssgManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout" style="margin-top:64px;display:flex;flex-direction:row"><div class="site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);background-color:transparent;flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></div><main class="ant-layout-content side-layout-main" style="max-width:1200px;min-width:0;display:block"><div style="padding:0 24px"><div class="main-content" role="main"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="serialization">Serialization<a aria-hidden="true" class="anchor-heading icon-link" href="#serialization"></a></h1>
<p><strong>Foundation</strong> library定義了<code>Encodable</code>, <code>Decodable</code>, 也提供<code>Encoder</code>, <code>Decoder</code> API讓我們可以很方便地進行資料處理。</p>
<p>當我們需要更深入的設定時，也可以使用<code>EncodableWithConfiguration</code>, <code>DecodableWithConfiguration</code>這兩個protocols。</p>
<h2 id="為何我們需要將資料encodedecode呢">為何我們需要將資料encode、decode呢？<a aria-hidden="true" class="anchor-heading icon-link" href="#為何我們需要將資料encodedecode呢"></a></h2>
<p>當我們透過網路傳送資料、將資料存到硬碟上，通常都需要先將檔案編碼成特定的格式再做傳輸、儲存。</p>
<p>而我們在撰寫程式碼時，會定義出一些類(class、struct)，當我們需要將這些類別的實體拿來做傳輸、儲存時，我們必須要讓這個類<code>Codable</code>，才可以透過Decoder、Encoder處理我們的資料。</p>
<h2 id="codable-behind-the-scenes"><code>Codable</code> Behind the scenes<a aria-hidden="true" class="anchor-heading icon-link" href="#codable-behind-the-scenes"></a></h2>
<p><img src="/programming_notes/../assets/images/programming.language.swift.Serialization_behind-the-scenes.png" alt="codable behind the scenes"></p>
<h2 id="example">Example<a aria-hidden="true" class="anchor-heading icon-link" href="#example"></a></h2>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">TestEncode</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> intArr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>

<span class="token comment">// Instance method 'encode' requires that 'TestEncode' conform to 'Encodable'</span>
<span class="token keyword">let</span> encodedJSONData <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">JSONEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">TestEncode</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"encode&#x26;decode"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> encodedPropertyListData <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">?</span> <span class="token class-name">PropertyListEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span><span class="token class-name">TestEncode</span><span class="token punctuation">(</span>id<span class="token punctuation">:</span> <span class="token string-literal"><span class="token string">"encode&#x26;Decode"</span></span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>如果自定義的類沒有遵守<code>Encodable</code> protocol，encoder的encode方法是沒有辦法接收自定義類的實例的。</p>
<p>這時候只需要讓TestEncode遵守<code>Encodable</code>，即可順利encode了</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">struct</span> <span class="token class-name">TestEncode</span><span class="token punctuation">:</span> <span class="token class-name">Encodable</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> id<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> intArr<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token class-name">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="foundation-codable-types">Foundation codable types<a aria-hidden="true" class="anchor-heading icon-link" href="#foundation-codable-types"></a></h2>
<ul>
<li>String</li>
<li>Int</li>
<li>Double</li>
<li>Date</li>
<li>Data</li>
<li>URL</li>
</ul>
<h2 id="自定義-codingkeys">自定義 <code>CodingKeys</code><a aria-hidden="true" class="anchor-heading icon-link" href="#自定義-codingkeys"></a></h2>
<p>當自定義的類遵守<code>Codable</code>時，我們可以選擇在類別內宣告一個叫<code>CodingKeys</code>的enum，且這個enum需遵守<code>CodingKey</code>協議。</p>
<pre class="language-swift"><code class="language-swift"><span class="token comment">/// A type that can be used as a key for encoding and decoding.</span>
<span class="token keyword">public</span> <span class="token keyword">protocol</span> <span class="token class-name">CodingKey</span> <span class="token punctuation">:</span> <span class="token class-name">CustomDebugStringConvertible</span><span class="token punctuation">,</span> <span class="token class-name">CustomStringConvertible</span><span class="token punctuation">,</span> <span class="token class-name">Sendable</span> <span class="token punctuation">{</span>

    <span class="token comment">/// The string to use in a named collection (e.g. a string-keyed dictionary).</span>
    <span class="token keyword">var</span> stringValue<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>

    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>stringValue<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">)</span>

    <span class="token comment">/// The value to use in an integer-indexed collection (e.g. an int-keyed dictionary).</span>
    <span class="token keyword">var</span> intValue<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token operator">?</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>

    <span class="token keyword">init</span><span class="token operator">?</span><span class="token punctuation">(</span>intValue<span class="token punctuation">:</span> <span class="token class-name">Int</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">extension</span> <span class="token class-name">CodingKey</span> <span class="token punctuation">{</span>
    <span class="token comment">/// A textual representation of this key.</span>
    <span class="token keyword">public</span> <span class="token keyword">var</span> description<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>

    <span class="token comment">/// A textual representation of this key, suitable for debugging.</span>
    <span class="token keyword">public</span> <span class="token keyword">var</span> debugDescription<span class="token punctuation">:</span> <span class="token class-name">String</span> <span class="token punctuation">{</span> <span class="token keyword">get</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="why">Why?<a aria-hidden="true" class="anchor-heading icon-link" href="#why"></a></h3>
<p>有時候序列化後的資料格式(key-value pair)的key命名並不符合Swift的命名邏輯，且有時候這個key會頻繁被更改，與其隨著這些外部的資料key去做property的命名，不如就透過宣告<code>CodingKeys</code>拿來map這些外部的資料格式。</p>
<pre class="language-swift"><code class="language-swift"><span class="token keyword">let</span> mockJSONData <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"""
    {
      5"first_name": "Jason",
      "last_name": "Chung"
    }
"""</span></span>

<span class="token keyword">struct</span> <span class="token class-name">User</span><span class="token punctuation">:</span> <span class="token class-name">Codable</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> firstName<span class="token punctuation">:</span> <span class="token class-name">String</span>
    <span class="token keyword">let</span> lastName<span class="token punctuation">:</span> <span class="token class-name">String</span>

    <span class="token keyword">enum</span> <span class="token class-name">CodingKeys</span><span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">CodingKey</span> <span class="token punctuation">{</span>
      <span class="token keyword">case</span> firstName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"first_name"</span></span>
      <span class="token keyword">case</span> lastName <span class="token operator">=</span> <span class="token string-literal"><span class="token string">"last_name"</span></span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> encodedJSONData <span class="token operator">=</span> <span class="token keyword">try</span><span class="token operator">!</span> mockJSONData<span class="token punctuation">.</span><span class="token function">data</span><span class="token punctuation">(</span>using<span class="token punctuation">:</span> <span class="token punctuation">.</span>utf8<span class="token punctuation">)</span><span class="token operator">!</span>
<span class="token keyword">let</span> decodedJSONData <span class="token operator">=</span> <span class="token keyword">try</span> <span class="token class-name">JSONDecoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span><span class="token class-name">User</span><span class="token punctuation">.</span><span class="token keyword">self</span><span class="token punctuation">,</span> from<span class="token punctuation">:</span> encodedJSONData<span class="token punctuation">)</span>
</code></pre>
<h2 id="codable常用的情境"><code>Codable</code>常用的情境：<a aria-hidden="true" class="anchor-heading icon-link" href="#codable常用的情境"></a></h2>
<ol>
<li>JSON Serialization/Deserialization</li>
<li>PropertyList Serialization</li>
<li>UserDefaults</li>
<li>Unit Testing (透過自定義類建立假資料，轉換成JSON格式測試Decoding出錯情境)</li>
</ol>
<hr>
<strong>Children</strong>
<ol>
<li><a href="/programming_notes/notes/ehit98sudwsnivfx8dnovwq">Decoding JSON</a></li>
</ol></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#為何我們需要將資料encodedecode呢" title="為何我們需要將資料encode、decode呢？">為何我們需要將資料encode、decode呢？</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#codable-behind-the-scenes" title="Codable Behind the scenes">Codable Behind the scenes</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#example" title="Example">Example</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#foundation-codable-types" title="Foundation codable types">Foundation codable types</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#自定義-codingkeys" title="自定義 CodingKeys">自定義 CodingKeys</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#why" title="Why?">Why?</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#codable常用的情境" title="Codable常用的情境：">Codable常用的情境：</a></div></div></div></div></div></div></div></div></div></div></div><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></main></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"rxplme0keulo3fon6e4gxmc","title":"Serialization","desc":"","updated":1703489251057,"created":1703433158198,"custom":{},"fname":"programming.language.swift.Serialization","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"26116e4cfd4107a3dcacaf249a71566e","links":[],"anchors":{"為何我們需要將資料encodedecode呢":{"type":"header","text":"為何我們需要將資料encode、decode呢？","value":"為何我們需要將資料encodedecode呢","line":12,"column":0,"depth":2},"codable-behind-the-scenes":{"type":"header","text":"Codable Behind the scenes","value":"codable-behind-the-scenes","line":18,"column":0,"depth":2},"example":{"type":"header","text":"Example","value":"example","line":22,"column":0,"depth":2},"foundation-codable-types":{"type":"header","text":"Foundation codable types","value":"foundation-codable-types","line":46,"column":0,"depth":2},"自定義-codingkeys":{"type":"header","text":"自定義 CodingKeys","value":"自定義-codingkeys","line":55,"column":0,"depth":2},"why":{"type":"header","text":"Why?","value":"why","line":83,"column":0,"depth":3},"codable常用的情境":{"type":"header","text":"Codable常用的情境：","value":"codable常用的情境","line":109,"column":0,"depth":2}},"children":["ehit98sudwsnivfx8dnovwq"],"parent":"vztg7xzj0425ae5ogmk8ds2","data":{}},"body":"\u003ch1 id=\"serialization\"\u003eSerialization\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#serialization\"\u003e\u003c/a\u003e\u003c/h1\u003e\n\u003cp\u003e\u003cstrong\u003eFoundation\u003c/strong\u003e library定義了\u003ccode\u003eEncodable\u003c/code\u003e, \u003ccode\u003eDecodable\u003c/code\u003e, 也提供\u003ccode\u003eEncoder\u003c/code\u003e, \u003ccode\u003eDecoder\u003c/code\u003e API讓我們可以很方便地進行資料處理。\u003c/p\u003e\n\u003cp\u003e當我們需要更深入的設定時，也可以使用\u003ccode\u003eEncodableWithConfiguration\u003c/code\u003e, \u003ccode\u003eDecodableWithConfiguration\u003c/code\u003e這兩個protocols。\u003c/p\u003e\n\u003ch2 id=\"為何我們需要將資料encodedecode呢\"\u003e為何我們需要將資料encode、decode呢？\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#為何我們需要將資料encodedecode呢\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e當我們透過網路傳送資料、將資料存到硬碟上，通常都需要先將檔案編碼成特定的格式再做傳輸、儲存。\u003c/p\u003e\n\u003cp\u003e而我們在撰寫程式碼時，會定義出一些類(class、struct)，當我們需要將這些類別的實體拿來做傳輸、儲存時，我們必須要讓這個類\u003ccode\u003eCodable\u003c/code\u003e，才可以透過Decoder、Encoder處理我們的資料。\u003c/p\u003e\n\u003ch2 id=\"codable-behind-the-scenes\"\u003e\u003ccode\u003eCodable\u003c/code\u003e Behind the scenes\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#codable-behind-the-scenes\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e\u003cimg src=\"/programming_notes/../assets/images/programming.language.swift.Serialization_behind-the-scenes.png\" alt=\"codable behind the scenes\"\u003e\u003c/p\u003e\n\u003ch2 id=\"example\"\u003eExample\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#example\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTestEncode\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e id\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e intArr\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eInt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token comment\"\u003e// Instance method 'encode' requires that 'TestEncode' conform to 'Encodable'\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e encodedJSONData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eJSONEncoder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eencode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eTestEncode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"encode\u0026#x26;decode\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e encodedPropertyListData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token class-name\"\u003ePropertyListEncoder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003eencode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eTestEncode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eid\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"encode\u0026#x26;Decode\"\u003c/span\u003e\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e如果自定義的類沒有遵守\u003ccode\u003eEncodable\u003c/code\u003e protocol，encoder的encode方法是沒有辦法接收自定義類的實例的。\u003c/p\u003e\n\u003cp\u003e這時候只需要讓TestEncode遵守\u003ccode\u003eEncodable\u003c/code\u003e，即可順利encode了\u003c/p\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eTestEncode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eEncodable\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e id\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e intArr\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eInt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e[\u003c/span\u003e\u003cspan class=\"token number\"\u003e1\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e2\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e3\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e4\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e\u003cspan class=\"token number\"\u003e5\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e]\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"foundation-codable-types\"\u003eFoundation codable types\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#foundation-codable-types\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cul\u003e\n\u003cli\u003eString\u003c/li\u003e\n\u003cli\u003eInt\u003c/li\u003e\n\u003cli\u003eDouble\u003c/li\u003e\n\u003cli\u003eDate\u003c/li\u003e\n\u003cli\u003eData\u003c/li\u003e\n\u003cli\u003eURL\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2 id=\"自定義-codingkeys\"\u003e自定義 \u003ccode\u003eCodingKeys\u003c/code\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#自定義-codingkeys\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003cp\u003e當自定義的類遵守\u003ccode\u003eCodable\u003c/code\u003e時，我們可以選擇在類別內宣告一個叫\u003ccode\u003eCodingKeys\u003c/code\u003e的enum，且這個enum需遵守\u003ccode\u003eCodingKey\u003c/code\u003e協議。\u003c/p\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token comment\"\u003e/// A type that can be used as a key for encoding and decoding.\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eprotocol\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCodingKey\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCustomDebugStringConvertible\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCustomStringConvertible\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eSendable\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e/// The string to use in a named collection (e.g. a string-keyed dictionary).\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e stringValue\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003einit\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003estringValue\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e/// The value to use in an integer-indexed collection (e.g. an int-keyed dictionary).\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e intValue\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eInt\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003einit\u003c/span\u003e\u003cspan class=\"token operator\"\u003e?\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eintValue\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eInt\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003eextension\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCodingKey\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token comment\"\u003e/// A textual representation of this key.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e description\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n    \u003cspan class=\"token comment\"\u003e/// A textual representation of this key, suitable for debugging.\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003epublic\u003c/span\u003e \u003cspan class=\"token keyword\"\u003evar\u003c/span\u003e debugDescription\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e \u003cspan class=\"token keyword\"\u003eget\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch3 id=\"why\"\u003eWhy?\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#why\"\u003e\u003c/a\u003e\u003c/h3\u003e\n\u003cp\u003e有時候序列化後的資料格式(key-value pair)的key命名並不符合Swift的命名邏輯，且有時候這個key會頻繁被更改，與其隨著這些外部的資料key去做property的命名，不如就透過宣告\u003ccode\u003eCodingKeys\u003c/code\u003e拿來map這些外部的資料格式。\u003c/p\u003e\n\u003cpre class=\"language-swift\"\u003e\u003ccode class=\"language-swift\"\u003e\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e mockJSONData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"\"\"\n    {\n      5\"first_name\": \"Jason\",\n      \"last_name\": \"Chung\"\n    }\n\"\"\"\u003c/span\u003e\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003estruct\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCodable\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e firstName\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\n    \u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e lastName\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\n\n    \u003cspan class=\"token keyword\"\u003eenum\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCodingKeys\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eString\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eCodingKey\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e{\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e firstName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"first_name\"\u003c/span\u003e\u003c/span\u003e\n      \u003cspan class=\"token keyword\"\u003ecase\u003c/span\u003e lastName \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token string-literal\"\u003e\u003cspan class=\"token string\"\u003e\"last_name\"\u003c/span\u003e\u003c/span\u003e\n    \u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\u003cspan class=\"token punctuation\"\u003e}\u003c/span\u003e\n\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e encodedJSONData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e mockJSONData\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edata\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003eusing\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e \u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003eutf8\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token operator\"\u003e!\u003c/span\u003e\n\u003cspan class=\"token keyword\"\u003elet\u003c/span\u003e decodedJSONData \u003cspan class=\"token operator\"\u003e=\u003c/span\u003e \u003cspan class=\"token keyword\"\u003etry\u003c/span\u003e \u003cspan class=\"token class-name\"\u003eJSONDecoder\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token function\"\u003edecode\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e(\u003c/span\u003e\u003cspan class=\"token class-name\"\u003eUser\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e.\u003c/span\u003e\u003cspan class=\"token keyword\"\u003eself\u003c/span\u003e\u003cspan class=\"token punctuation\"\u003e,\u003c/span\u003e from\u003cspan class=\"token punctuation\"\u003e:\u003c/span\u003e encodedJSONData\u003cspan class=\"token punctuation\"\u003e)\u003c/span\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"codable常用的情境\"\u003e\u003ccode\u003eCodable\u003c/code\u003e常用的情境：\u003ca aria-hidden=\"true\" class=\"anchor-heading icon-link\" href=\"#codable常用的情境\"\u003e\u003c/a\u003e\u003c/h2\u003e\n\u003col\u003e\n\u003cli\u003eJSON Serialization/Deserialization\u003c/li\u003e\n\u003cli\u003ePropertyList Serialization\u003c/li\u003e\n\u003cli\u003eUserDefaults\u003c/li\u003e\n\u003cli\u003eUnit Testing (透過自定義類建立假資料，轉換成JSON格式測試Decoding出錯情境)\u003c/li\u003e\n\u003c/ol\u003e\n\u003chr\u003e\n\u003cstrong\u003eChildren\u003c/strong\u003e\n\u003col\u003e\n\u003cli\u003e\u003ca href=\"/programming_notes/notes/ehit98sudwsnivfx8dnovwq\"\u003eDecoding JSON\u003c/a\u003e\u003c/li\u003e\n\u003c/ol\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1605266684036,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","selfContained":true,"name":"Dendron"},"contentHash":"b49e7e13a0c91addc8ab9ef97080cf1e","links":[],"anchors":{},"children":["p1jj2aztluo4pb12qn8gunp","avquk6puzxi790rxzodnfmh","rn0e0y5coqo8iyqfxd7ocsk","c1bs7wsjfbhb0zipaywqv1"],"parent":null,"data":{},"body":"\nThis is the root for your Dendron vault.\n\nIf you decide to publish your entire vault, it will be your landing page. You are free to customize any part of this page except the frontmatter at the top, between the `---`.\n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true,"enableSelfContainedVaults":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":true,"vaultSelectionModeOnCreate":"smart","leaveTrace":false,"bubbleUpCreateNew":true,"fuzzThreshold":0.2}},"randomNote":{},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{"aliasMode":"title"},"templateHierarchy":"template"},"workspace":{"vaults":[{"fsPath":".","selfContained":true,"name":"Dendron"}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"task","dateFormat":"y.MM.dd","addBehavior":"asOwnDomain","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"taskCompleteStatus":["done","x"],"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1,"createStub":false},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"enableEditorDecorations":true,"maxPreviewsCached":10,"maxNoteLength":204800,"enableFullHierarchyNoteTitle":false,"enablePersistentHistory":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enablePrettyRefs":true,"enableKatex":true,"copyAssets":true,"siteHierarchies":["root"],"writeStubs":false,"siteRootDir":"docs","seo":{"title":"Dendron","description":"Personal Knowledge Space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitHub","editBranch":"main","editViewMode":"tree"},"enableSiteLastModified":true,"enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"enableTaskNotes":true,"enablePrettyLinks":true,"searchMode":"search","siteUrl":"https://qazwsx521943.github.io","assetsPrefix":"/programming_notes","siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"rxplme0keulo3fon6e4gxmc"},"buildId":"nSFlPafzYJhNeKeOHrNay","assetPrefix":"/programming_notes","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>